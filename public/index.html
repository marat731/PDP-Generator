<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Walmart Mockup Generator</title>
    <style>
        @font-face {
            font-family: 'Bogle';
            src: local('Bogle'), local('Arial');
            font-weight: 400;
        }
        @font-face {
            font-family: 'Bogle';
            src: local('Bogle Bold'), local('Arial Bold');
            font-weight: 700;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --color-core-blue-100: #0071dc;
            --color-core-blue-130: #004f9a;
            --color-core-blue-160: #002d58;
            --color-core-spark-100: #ffc220;
            --color-core-green-100: #2a8703;
            --color-core-gray-160: #2e2f32;
            --color-core-gray-100: #74767c;
            --color-core-gray-50: #babbbe;
            --color-core-gray-20: #e3e4e5;
            --color-core-gray-10: #f1f1f2;
            --color-core-white: #fff;
            --color-core-black: #000;
        }

        body {
            font-family: Bogle, 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: var(--color-core-gray-10);
            color: var(--color-core-gray-160);
            font-size: 14px;
            line-height: 1.5;
        }

        /* Top Control Bar */
        .control-bar {
            background: var(--color-core-blue-160);
            color: white;
            padding: 12px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .control-bar h1 {
            font-size: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .spark-icon-small {
            width: 24px;
            height: 24px;
            background: var(--color-core-spark-100);
            border-radius: 50%;
        }

        .control-buttons {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .save-status {
            font-size: 12px;
            opacity: 0.8;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--color-core-spark-100);
            color: var(--color-core-gray-160);
        }

        .btn-primary:hover {
            background: #e6af1d;
        }

        .btn-secondary {
            background: transparent;
            color: white;
            border: 2px solid white;
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.1);
        }

        /* Main Layout */
        .app-layout {
            display: grid;
            grid-template-columns: 360px 1fr;
            min-height: calc(100vh - 56px);
        }

        @media (max-width: 1200px) {
            .app-layout {
                grid-template-columns: 1fr;
            }
        }

        /* Editor Sidebar */
        .editor-sidebar {
            background: white;
            padding: 24px;
            overflow-y: auto;
            max-height: calc(100vh - 56px);
            border-right: 1px solid var(--color-core-gray-20);
        }

        .editor-section {
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--color-core-gray-20);
        }

        .editor-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .editor-section h3 {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--color-core-gray-160);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-group label {
            display: block;
            font-size: 12px;
            font-weight: 700;
            margin-bottom: 6px;
            color: var(--color-core-gray-100);
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--color-core-gray-50);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--color-core-blue-100);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .help-text {
            font-size: 11px;
            color: var(--color-core-gray-100);
            margin-top: 4px;
        }

        /* Image Upload */
        .image-upload-zone {
            border: 2px dashed var(--color-core-gray-50);
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--color-core-gray-10);
        }

        .image-upload-zone:hover,
        .image-upload-zone.dragover {
            border-color: var(--color-core-blue-100);
            background: #f0f7ff;
        }

        .upload-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .image-preview {
            width: 60px;
            height: 60px;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
            border: 2px solid var(--color-core-gray-20);
            cursor: grab;
        }

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-preview-remove {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 18px;
            height: 18px;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Bullet Points */
        .bullet-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .bullet-item {
            display: flex;
            gap: 8px;
        }

        .bullet-input {
            flex: 1;
        }

        .bullet-remove {
            width: 32px;
            height: 32px;
            background: var(--color-core-gray-10);
            border: 1px solid var(--color-core-gray-20);
            border-radius: 6px;
            cursor: pointer;
            color: var(--color-core-gray-100);
        }

        .bullet-remove:hover {
            background: #fee;
            border-color: #fcc;
            color: #c00;
        }

        .add-bullet {
            background: none;
            border: 1px dashed var(--color-core-gray-50);
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            color: var(--color-core-blue-100);
            font-size: 13px;
            margin-top: 8px;
        }

        .add-bullet:hover {
            background: var(--color-core-gray-10);
        }

        /* Preview Area */
        .preview-area {
            padding: 24px;
            overflow-y: auto;
        }

        .preview-label {
            font-size: 11px;
            font-weight: 700;
            color: var(--color-core-gray-100);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        /* Walmart PDP Preview */
        .walmart-pdp {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .walmart-header {
            background: var(--color-core-blue-100);
            height: 56px;
            display: flex;
            align-items: center;
            padding: 0 20px;
        }

        .walmart-logo {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .spark-icon {
            width: 28px;
            height: 28px;
            background: var(--color-core-spark-100);
            border-radius: 50%;
        }

        .walmart-text {
            color: white;
            font-size: 18px;
            font-weight: 700;
        }

        .pdp-container {
            padding: 20px;
        }

        .breadcrumb {
            font-size: 11px;
            color: var(--color-core-gray-100);
            margin-bottom: 16px;
        }

        .breadcrumb a {
            color: inherit;
            text-decoration: none;
        }

        /* 3-Column Layout */
        .product-layout {
            display: grid;
            grid-template-columns: 280px 1fr 240px;
            gap: 20px;
            align-items: start;
        }

        @media (max-width: 1400px) {
            .product-layout {
                grid-template-columns: 240px 1fr 200px;
            }
        }

        /* Gallery */
        .product-gallery {
            position: sticky;
            top: 20px;
        }

        .main-image-container {
            width: 100%;
            aspect-ratio: 1;
            border: 1px solid var(--color-core-gray-20);
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            margin-bottom: 12px;
        }

        .main-image-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .placeholder-image {
            color: var(--color-core-gray-100);
            text-align: center;
        }

        .thumbnail-row {
            display: flex;
            gap: 6px;
            justify-content: center;
        }

        .thumbnail {
            width: 48px;
            height: 48px;
            border: 2px solid var(--color-core-gray-20);
            border-radius: 6px;
            cursor: pointer;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .thumbnail:hover,
        .thumbnail.active {
            border-color: var(--color-core-blue-100);
        }

        .thumbnail img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        /* Product Info */
        .product-info {
            min-width: 0;
        }

        .product-brand {
            font-size: 11px;
            color: var(--color-core-gray-100);
            margin-bottom: 4px;
        }

        .product-brand a {
            color: inherit;
            text-decoration: underline;
        }

        .product-title {
            font-size: 18px;
            font-weight: 700;
            line-height: 1.3;
            margin-bottom: 10px;
        }

        .rating-row {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 16px;
        }

        .stars {
            display: flex;
            gap: 1px;
        }

        .star {
            width: 14px;
            height: 14px;
            fill: var(--color-core-spark-100);
        }

        .star.empty {
            fill: var(--color-core-gray-50);
        }

        .rating-text {
            font-size: 12px;
            color: var(--color-core-gray-100);
        }

        .section-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--color-core-gray-20);
        }

        .product-description {
            font-size: 13px;
            line-height: 1.6;
            color: var(--color-core-gray-160);
            margin-bottom: 16px;
        }

        .features-list {
            list-style: none;
            padding: 0;
        }

        .features-list li {
            position: relative;
            padding-left: 16px;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .features-list li::before {
            content: '‚Ä¢';
            position: absolute;
            left: 4px;
            color: var(--color-core-gray-160);
        }

        /* Buy Box */
        .buy-box {
            background: white;
            border: 1px solid var(--color-core-gray-20);
            border-radius: 8px;
            padding: 16px;
            position: sticky;
            top: 20px;
        }

        .price-section {
            margin-bottom: 12px;
        }

        .current-price {
            font-size: 28px;
            font-weight: 700;
        }

        .price-cents {
            font-size: 16px;
            vertical-align: super;
        }

        .unit-price {
            font-size: 11px;
            color: var(--color-core-gray-100);
        }

        .wplus-banner {
            background: linear-gradient(135deg, var(--color-core-blue-100), var(--color-core-blue-130));
            color: white;
            padding: 10px 12px;
            border-radius: 6px;
            margin-bottom: 12px;
            font-size: 11px;
        }

        .wplus-logo {
            font-weight: 700;
            margin-bottom: 2px;
        }

        .fulfillment-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid var(--color-core-gray-20);
        }

        .fulfillment-option:last-of-type {
            border-bottom: none;
        }

        .fulfillment-icon {
            width: 32px;
            height: 32px;
            background: var(--color-core-blue-100);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .fulfillment-icon svg {
            width: 16px;
            height: 16px;
            fill: white;
        }

        .fulfillment-title {
            font-size: 12px;
            font-weight: 700;
        }

        .fulfillment-subtitle {
            font-size: 11px;
            color: var(--color-core-gray-100);
        }

        .add-to-cart-btn {
            width: 100%;
            padding: 12px;
            background: var(--color-core-blue-100);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 12px;
        }

        .add-to-cart-btn:hover {
            background: var(--color-core-blue-130);
        }

        .seller-info {
            margin-top: 12px;
            font-size: 11px;
            color: var(--color-core-gray-100);
            text-align: center;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 32px;
            border-radius: 16px;
            max-width: 480px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .url-display {
            background: var(--color-core-gray-10);
            padding: 12px;
            border-radius: 8px;
            font-size: 13px;
            word-break: break-all;
            margin-bottom: 12px;
            border: 1px solid var(--color-core-gray-20);
        }

        .copy-btn {
            background: var(--color-core-blue-100);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 700;
            font-size: 13px;
        }

        #loadError {
            color: #de1c24;
            font-size: 13px;
            margin-top: 12px;
        }
    </style>
</head>
<body>
    <!-- Control Bar -->
    <div class="control-bar">
        <h1>
            <div class="spark-icon-small"></div>
            Walmart Mockup Generator
        </h1>
        <div class="control-buttons">
            <span class="save-status" id="saveStatus"></span>
            <button class="btn btn-secondary" onclick="loadExisting()">Load Existing</button>
            <button class="btn btn-secondary" onclick="newMockup()">New</button>
            <button class="btn btn-primary" onclick="saveMockup()">Save & Share</button>
        </div>
    </div>

    <!-- Main Layout -->
    <div class="app-layout">
        <!-- Editor Sidebar -->
        <div class="editor-sidebar">
            <div class="editor-section">
                <h3>Product Images</h3>
                <div class="form-group">
                    <div class="image-upload-zone" id="imageUploadZone">
                        <div class="upload-icon">üì∏</div>
                        <div>Drop images here or click to browse</div>
                    </div>
                    <input type="file" id="imageInput" accept="image/*" multiple style="display: none;">
                    <div class="image-preview-container" id="imagePreviewContainer"></div>
                </div>
            </div>

            <div class="editor-section">
                <h3>Product Information</h3>
                <div class="form-group">
                    <label>Brand Name</label>
                    <input type="text" id="brandInput" placeholder="e.g., Nature Nate's">
                </div>
                <div class="form-group">
                    <label>Product Title</label>
                    <input type="text" id="titleInput" placeholder="Full product name">
                </div>
                <div class="form-group">
                    <label>Price ($)</label>
                    <input type="text" id="priceInput" placeholder="7.97">
                </div>
                <div class="form-group">
                    <label>Rating (1-5)</label>
                    <input type="number" id="ratingInput" min="1" max="5" step="0.1" placeholder="4.5">
                </div>
                <div class="form-group">
                    <label>Number of Reviews</label>
                    <input type="number" id="reviewsInput" placeholder="1234">
                </div>
            </div>

            <div class="editor-section">
                <h3>Description</h3>
                <div class="form-group">
                    <textarea id="descriptionInput" placeholder="Product description..."></textarea>
                </div>
            </div>

            <div class="editor-section">
                <h3>Key Features</h3>
                <div class="form-group">
                    <div class="bullet-list" id="bulletList">
                        <div class="bullet-item">
                            <input type="text" placeholder="Feature 1" class="bullet-input">
                            <button class="bullet-remove" onclick="removeBullet(this)">‚úï</button>
                        </div>
                    </div>
                    <button class="add-bullet" onclick="addBullet()">+ Add Feature</button>
                </div>
            </div>

            <div class="editor-section">
                <h3>Privacy</h3>
                <div class="form-group">
                    <label>Password (Optional)</label>
                    <input type="password" id="passwordInput" placeholder="Leave blank for public">
                    <div class="help-text">Clients need this password to view</div>
                </div>
            </div>
        </div>

        <!-- Preview Area -->
        <div class="preview-area">
            <div class="preview-label">Live Preview</div>
            
            <div class="walmart-pdp">
                <!-- Walmart Header -->
                <div class="walmart-header">
                    <div class="walmart-logo">
                        <div class="spark-icon"></div>
                        <span class="walmart-text">Walmart</span>
                    </div>
                </div>

                <div class="pdp-container">
                    <div class="breadcrumb">
                        <a href="#">Home</a> / <a href="#">Food</a> / <a href="#">Pantry</a> / Product
                    </div>

                    <div class="product-layout">
                        <!-- Gallery -->
                        <div class="product-gallery">
                            <div class="main-image-container" id="mainImage">
                                <div class="placeholder-image">
                                    <div style="font-size: 48px;">üì¶</div>
                                    <div>Upload images</div>
                                </div>
                            </div>
                            <div class="thumbnail-row" id="thumbnailStrip"></div>
                        </div>

                        <!-- Product Info -->
                        <div class="product-info">
                            <div class="product-brand"><a href="#" id="displayBrand">Brand Name</a></div>
                            <h1 class="product-title" id="displayTitle">Product Title</h1>
                            
                            <div class="rating-row">
                                <div class="stars" id="displayStars">
                                    <svg class="star" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                                    <svg class="star" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                                    <svg class="star" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                                    <svg class="star" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                                    <svg class="star" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                                </div>
                                <span class="rating-text" id="displayRating">(0 reviews)</span>
                            </div>

                            <h2 class="section-title">About this item</h2>
                            <p class="product-description" id="displayDescription">Add description...</p>
                            <ul class="features-list" id="displayFeatures">
                                <li>Feature 1</li>
                            </ul>
                        </div>

                        <!-- Buy Box -->
                        <div class="buy-box">
                            <div class="price-section">
                                <div class="current-price" id="displayPrice">$0<span class="price-cents">.00</span></div>
                                <div class="unit-price">Price when purchased online</div>
                            </div>

                            <div class="wplus-banner">
                                <div class="wplus-logo">Walmart+</div>
                                <div>Free delivery on $35+ orders</div>
                            </div>

                            <div class="fulfillment-option">
                                <div class="fulfillment-icon">
                                    <svg viewBox="0 0 24 24"><path d="M19 7h-3V6a4 4 0 0 0-8 0v1H5a1 1 0 0 0-1 1v12a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V8a1 1 0 0 0-1-1zm-9-1a2 2 0 0 1 4 0v1h-4V6z"/></svg>
                                </div>
                                <div>
                                    <div class="fulfillment-title">Pickup</div>
                                    <div class="fulfillment-subtitle">Available today</div>
                                </div>
                            </div>

                            <div class="fulfillment-option">
                                <div class="fulfillment-icon">
                                    <svg viewBox="0 0 24 24"><path d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4z"/></svg>
                                </div>
                                <div>
                                    <div class="fulfillment-title">Delivery</div>
                                    <div class="fulfillment-subtitle">Arrives tomorrow</div>
                                </div>
                            </div>

                            <button class="add-to-cart-btn">Add to cart</button>
                            <div class="seller-info">Sold and shipped by Walmart</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="modal" id="shareModal">
        <div class="modal-content">
            <h2 class="modal-title">Mockup Saved! üéâ</h2>
            <p style="margin-bottom: 16px;">Share this link with your client:</p>
            <div class="url-display" id="shareUrl"></div>
            <button class="copy-btn" onclick="copyUrl()">Copy Link</button>
            <div class="help-text" style="margin-top: 12px;">
                <span id="passwordNote" style="display: none;">‚ö†Ô∏è Password protected</span>
            </div>
            <hr style="margin: 20px 0; border: none; border-top: 1px solid #e3e4e5;">
            <p style="font-size: 12px; color: #74767c; margin-bottom: 12px;">Edit link (save this!):</p>
            <div class="url-display" id="editUrl" style="font-size: 11px;"></div>
            <button class="copy-btn" onclick="copyEditUrl()" style="background: #74767c;">Copy Edit Link</button>
            <button class="btn btn-secondary" onclick="closeModal()" style="width: 100%; margin-top: 16px; color: #2e2f32; border-color: #babbbe;">Done</button>
        </div>
    </div>

    <!-- Load Modal -->
    <div class="modal" id="loadModal">
        <div class="modal-content">
            <h2 class="modal-title">Load Existing Mockup</h2>
            <p style="margin-bottom: 16px;">Enter the mockup ID or URL:</p>
            <div class="form-group">
                <input type="text" id="loadIdInput" placeholder="e.g., abc123 or full URL">
            </div>
            <div class="form-group">
                <input type="password" id="loadPasswordInput" placeholder="Password (if required)">
            </div>
            <div style="display: flex; gap: 12px; margin-top: 16px;">
                <button class="btn btn-secondary" onclick="closeLoadModal()" style="flex: 1; color: #2e2f32; border-color: #babbbe;">Cancel</button>
                <button class="btn btn-primary" onclick="submitLoad()" style="flex: 1;">Load</button>
            </div>
            <div id="loadError" style="display: none;"></div>
        </div>
    </div>

    <script>
        let uploadedImages = [];
        let currentImageIndex = 0;
        let currentMockupId = null;

        const imageUploadZone = document.getElementById('imageUploadZone');
        const imageInput = document.getElementById('imageInput');
        const imagePreviewContainer = document.getElementById('imagePreviewContainer');

        imageUploadZone.addEventListener('click', () => imageInput.click());
        imageUploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            imageUploadZone.classList.add('dragover');
        });
        imageUploadZone.addEventListener('dragleave', () => imageUploadZone.classList.remove('dragover'));
        imageUploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            imageUploadZone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });
        imageInput.addEventListener('change', (e) => handleFiles(e.target.files));

        function handleFiles(files) {
            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        uploadedImages.push(e.target.result);
                        updateImagePreviews();
                        updateMainDisplay();
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        function updateImagePreviews() {
            imagePreviewContainer.innerHTML = uploadedImages.map((img, index) => `
                <div class="image-preview" draggable="true" data-index="${index}">
                    <img src="${img}">
                    <button class="image-preview-remove" onclick="removeImage(${index})">‚úï</button>
                </div>
            `).join('');

            const previews = imagePreviewContainer.querySelectorAll('.image-preview');
            let draggedIndex = null;
            previews.forEach(preview => {
                preview.addEventListener('dragstart', (e) => draggedIndex = parseInt(e.target.dataset.index));
                preview.addEventListener('dragover', (e) => e.preventDefault());
                preview.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const dropIndex = parseInt(e.currentTarget.dataset.index);
                    if (draggedIndex !== null && draggedIndex !== dropIndex) {
                        [uploadedImages[draggedIndex], uploadedImages[dropIndex]] = [uploadedImages[dropIndex], uploadedImages[draggedIndex]];
                        updateImagePreviews();
                        updateMainDisplay();
                    }
                });
            });
        }

        function removeImage(index) {
            uploadedImages.splice(index, 1);
            if (currentImageIndex >= uploadedImages.length) currentImageIndex = Math.max(0, uploadedImages.length - 1);
            updateImagePreviews();
            updateMainDisplay();
        }

        function updateMainDisplay() {
            const mainImage = document.getElementById('mainImage');
            const thumbnailStrip = document.getElementById('thumbnailStrip');

            if (uploadedImages.length === 0) {
                mainImage.innerHTML = '<div class="placeholder-image"><div style="font-size:48px;">üì¶</div><div>Upload images</div></div>';
                thumbnailStrip.innerHTML = '';
                return;
            }

            mainImage.innerHTML = `<img src="${uploadedImages[currentImageIndex]}">`;
            thumbnailStrip.innerHTML = uploadedImages.map((img, index) => `
                <div class="thumbnail ${index === currentImageIndex ? 'active' : ''}" onclick="changeMainImage(${index})">
                    <img src="${img}">
                </div>
            `).join('');
        }

        function changeMainImage(index) {
            currentImageIndex = index;
            updateMainDisplay();
        }

        // Live updates
        document.getElementById('brandInput').addEventListener('input', (e) => {
            document.getElementById('displayBrand').textContent = e.target.value || 'Brand Name';
        });

        document.getElementById('titleInput').addEventListener('input', (e) => {
            document.getElementById('displayTitle').textContent = e.target.value || 'Product Title';
        });

        document.getElementById('priceInput').addEventListener('input', (e) => {
            const price = parseFloat(e.target.value) || 0;
            const dollars = Math.floor(price);
            const cents = Math.round((price - dollars) * 100).toString().padStart(2, '0');
            document.getElementById('displayPrice').innerHTML = `$${dollars}<span class="price-cents">.${cents}</span>`;
        });

        document.getElementById('ratingInput').addEventListener('input', (e) => {
            const rating = parseFloat(e.target.value) || 0;
            const starsContainer = document.getElementById('displayStars');
            starsContainer.innerHTML = '';
            for (let i = 1; i <= 5; i++) {
                const star = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                star.setAttribute('class', i <= rating ? 'star' : 'star empty');
                star.setAttribute('viewBox', '0 0 24 24');
                star.innerHTML = '<path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>';
                starsContainer.appendChild(star);
            }
        });

        document.getElementById('reviewsInput').addEventListener('input', (e) => {
            document.getElementById('displayRating').textContent = `(${e.target.value || 0} reviews)`;
        });

        document.getElementById('descriptionInput').addEventListener('input', (e) => {
            document.getElementById('displayDescription').textContent = e.target.value || 'Add description...';
        });

        function addBullet() {
            const bulletList = document.getElementById('bulletList');
            const newBullet = document.createElement('div');
            newBullet.className = 'bullet-item';
            newBullet.innerHTML = `<input type="text" placeholder="New feature" class="bullet-input"><button class="bullet-remove" onclick="removeBullet(this)">‚úï</button>`;
            bulletList.appendChild(newBullet);
            newBullet.querySelector('input').addEventListener('input', updateBulletDisplay);
        }

        function removeBullet(btn) {
            btn.parentElement.remove();
            updateBulletDisplay();
        }

        document.getElementById('bulletList').addEventListener('input', updateBulletDisplay);

        function updateBulletDisplay() {
            const bullets = Array.from(document.querySelectorAll('.bullet-input')).map(i => i.value).filter(v => v.trim());
            const displayFeatures = document.getElementById('displayFeatures');
            displayFeatures.innerHTML = bullets.length === 0 ? '<li>Add features</li>' : bullets.map(b => `<li>${b}</li>`).join('');
        }

        function getMockupData() {
            return {
                brand: document.getElementById('brandInput').value,
                title: document.getElementById('titleInput').value,
                price: document.getElementById('priceInput').value,
                rating: document.getElementById('ratingInput').value,
                reviews: document.getElementById('reviewsInput').value,
                description: document.getElementById('descriptionInput').value,
                images: uploadedImages,
                bullets: Array.from(document.querySelectorAll('.bullet-input')).map(i => i.value)
            };
        }

        async function saveMockup() {
            const saveStatus = document.getElementById('saveStatus');
            saveStatus.textContent = 'Saving...';
            
            try {
                const data = getMockupData();
                const password = document.getElementById('passwordInput').value;
                
                let response;
                if (currentMockupId) {
                    response = await fetch(`/api/mockups/${currentMockupId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ data, password: password || null })
                    });
                } else {
                    response = await fetch('/api/mockups', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ data, password: password || null })
                    });
                }
                
                const result = await response.json();
                
                if (result.success) {
                    if (!currentMockupId) currentMockupId = result.id;
                    saveStatus.textContent = 'Saved!';
                    setTimeout(() => saveStatus.textContent = '', 2000);
                    
                    const baseUrl = window.location.origin;
                    document.getElementById('shareUrl').textContent = `${baseUrl}/mockup/${currentMockupId}`;
                    document.getElementById('editUrl').textContent = `${baseUrl}/?id=${currentMockupId}${password ? '&pw=' + encodeURIComponent(password) : ''}`;
                    document.getElementById('passwordNote').style.display = password ? 'inline' : 'none';
                    document.getElementById('shareModal').classList.add('active');
                }
            } catch (error) {
                console.error('Error saving:', error);
                saveStatus.textContent = 'Error';
                setTimeout(() => saveStatus.textContent = '', 2000);
            }
        }

        function copyUrl() {
            navigator.clipboard.writeText(document.getElementById('shareUrl').textContent);
            event.target.textContent = 'Copied!';
            setTimeout(() => event.target.textContent = 'Copy Link', 2000);
        }

        function copyEditUrl() {
            navigator.clipboard.writeText(document.getElementById('editUrl').textContent);
            event.target.textContent = 'Copied!';
            setTimeout(() => event.target.textContent = 'Copy Edit Link', 2000);
        }

        function closeModal() {
            document.getElementById('shareModal').classList.remove('active');
        }

        function newMockup() {
            if (confirm('Start new mockup? Current changes will be lost.')) {
                window.location.href = '/';
            }
        }

        function loadExisting() {
            document.getElementById('loadModal').classList.add('active');
        }

        function closeLoadModal() {
            document.getElementById('loadModal').classList.remove('active');
            document.getElementById('loadIdInput').value = '';
            document.getElementById('loadPasswordInput').value = '';
            document.getElementById('loadError').style.display = 'none';
        }

        async function submitLoad() {
            const input = document.getElementById('loadIdInput').value.trim();
            const password = document.getElementById('loadPasswordInput').value;
            
            let id = input;
            if (input.includes('/mockup/')) id = input.split('/mockup/')[1].split('?')[0];
            else if (input.includes('?id=')) id = new URLSearchParams(input.split('?')[1]).get('id');
            
            try {
                const url = password ? `/api/mockups/${id}?password=${encodeURIComponent(password)}` : `/api/mockups/${id}`;
                const response = await fetch(url);
                const result = await response.json();
                
                if (!result.success) {
                    document.getElementById('loadError').textContent = result.error || 'Failed to load';
                    document.getElementById('loadError').style.display = 'block';
                    return;
                }
                
                currentMockupId = id;
                const data = result.data;
                
                document.getElementById('brandInput').value = data.brand || '';
                document.getElementById('titleInput').value = data.title || '';
                document.getElementById('priceInput').value = data.price || '';
                document.getElementById('ratingInput').value = data.rating || '';
                document.getElementById('reviewsInput').value = data.reviews || '';
                document.getElementById('descriptionInput').value = data.description || '';
                document.getElementById('passwordInput').value = password || '';
                
                uploadedImages = data.images || [];
                updateImagePreviews();
                updateMainDisplay();
                
                const bulletList = document.getElementById('bulletList');
                bulletList.innerHTML = '';
                (data.bullets || ['']).forEach((bullet, i) => {
                    const div = document.createElement('div');
                    div.className = 'bullet-item';
                    div.innerHTML = `<input type="text" placeholder="Feature ${i+1}" class="bullet-input" value="${bullet}"><button class="bullet-remove" onclick="removeBullet(this)">‚úï</button>`;
                    div.querySelector('input').addEventListener('input', updateBulletDisplay);
                    bulletList.appendChild(div);
                });
                
                ['brandInput','titleInput','priceInput','ratingInput','reviewsInput','descriptionInput'].forEach(id => {
                    document.getElementById(id).dispatchEvent(new Event('input'));
                });
                updateBulletDisplay();
                
                closeLoadModal();
            } catch (error) {
                document.getElementById('loadError').textContent = 'Error loading mockup';
                document.getElementById('loadError').style.display = 'block';
            }
        }

        // Auto-load from URL
        window.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');
            const pw = params.get('pw');
            if (id) {
                document.getElementById('loadIdInput').value = id;
                if (pw) document.getElementById('loadPasswordInput').value = pw;
                submitLoad();
            }
        });
    </script>
</body>
</html>
